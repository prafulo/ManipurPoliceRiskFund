// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String
  role      UserRole @default(UnitAdmin)
  unitId    String?  @map("unit_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  unit Unit? @relation(fields: [unitId], references: [id])

  @@map("users")
}

model Unit {
  id      String   @id @default(uuid())
  name    String   @unique
  members Member[]
  users   User[]
  transfersFrom Transfer[] @relation("FromUnit")
  transfersTo   Transfer[] @relation("ToUnit")

  @@map("units")
}

model Member {
  id                  String       @id @default(uuid())
  membershipCode      String       @unique
  name                String
  fatherName          String
  rank                String
  trade               String
  serviceNumber       String
  dateOfBirth         DateTime
  dateOfEnrollment    DateTime
  address             String
  phone               String
  unitId              String
  status              MemberStatus @default(Opened)
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt
  nominees            Json
  firstWitness        Json
  secondWitness       Json
  closureReason       ClosureReason?
  dateOfDischarge     DateTime?
  badgeNumber         String
  bloodGroup          String
  memberPostType      MemberPostType
  joiningRank         String
  superannuationDate  DateTime
  parentDepartment    String?
  subscriptionStartDate DateTime
  dateApplied         DateTime
  receiptDate         DateTime
  allotmentDate       DateTime
  closureNotes        String?

  unit     Unit      @relation(fields: [unitId], references: [id], onDelete: Restrict)
  payments Payment[]
  transfers Transfer[] @relation("MemberTransfers")

  @@map("members")
}

model Payment {
  id          String   @id @default(uuid())
  memberId    String
  amount      Decimal  @db.Decimal(10, 2)
  paymentDate DateTime
  months      Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  member Member @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@map("payments")
}


model Transfer {
  id           String   @id @default(uuid())
  memberId     String
  fromUnitId   String
  toUnitId     String
  transferDate DateTime
  createdAt    DateTime @default(now())

  member   Member @relation("MemberTransfers", fields: [memberId], references: [id], onDelete: Cascade)
  fromUnit Unit   @relation("FromUnit", fields: [fromUnitId], references: [id], onDelete: Restrict)
  toUnit   Unit   @relation("ToUnit", fields: [toUnitId], references: [id], onDelete: Restrict)

  @@map("transfers")
}

model Setting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("settings")
}


enum MemberStatus {
  Opened
  Closed
}

enum ClosureReason {
  Retirement
  Death
  Doubling
  Expelled
}

enum MemberPostType {
  Officiating
  Temporary
  Substantive
}

enum UserRole {
  SuperAdmin
  UnitAdmin
}
