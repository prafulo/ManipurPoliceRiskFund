
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Member {
  id                      String         @id @default(uuid())
  membershipCode          String         @unique
  name                    String
  fatherName              String
  rank                    String
  trade                   String
  serviceNumber           String
  badgeNumber             String
  bloodGroup              String
  memberPostType          MemberPostType
  joiningRank             String
  dateOfBirth             DateTime
  dateOfEnrollment        DateTime
  superannuationDate      DateTime
  dateOfDischarge         DateTime?
  address                 String
  phone                   String
  status                  MemberStatus   @default(Opened)
  closureReason           ClosureReason?
  closureNotes            String?        @db.Text
  subscriptionStartDate   DateTime
  parentDepartment        String?
  dateApplied             DateTime
  receiptDate             DateTime
  receiptNumber           String?
  allotmentDate           DateTime
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt
  unitId                  String
  unit                    Unit           @relation(fields: [unitId], references: [id])
  nominees                Json
  firstWitness            Json
  secondWitness           Json
  payments                Payment[]
  transfers               Transfer[]
}

model Unit {
  id            String     @id @default(uuid())
  name          String     @unique
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  members       Member[]
  transfersFrom Transfer[] @relation("FromUnit")
  transfersTo   Transfer[] @relation("ToUnit")
  users         User[]
}

model Payment {
  id          String   @id @default(uuid())
  memberId    String
  amount      Decimal  @db.Decimal(10, 2)
  months      Json
  paymentDate DateTime
  createdAt   DateTime @default(now())
  member      Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
}

model Transfer {
  id           String   @id @default(uuid())
  memberId     String
  fromUnitId   String
  toUnitId     String
  transferDate DateTime
  createdAt    DateTime @default(now())
  member       Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  fromUnit     Unit     @relation("FromUnit", fields: [fromUnitId], references: [id])
  toUnit       Unit     @relation("ToUnit", fields: [toUnitId], references: [id])
}

model Setting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id        String    @id @default(uuid())
  email     String    @unique
  name      String
  password  String
  role      UserRole
  unitId    String?
  unit      Unit?     @relation(fields: [unitId], references: [id])
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

enum MemberStatus {
  Opened
  Closed
}

enum ClosureReason {
  Retirement
  Death
  Doubling
  Expelled
}

enum MemberPostType {
  Officiating
  Temporary
  Substantive
}

enum UserRole {
  SuperAdmin
  UnitAdmin
}
