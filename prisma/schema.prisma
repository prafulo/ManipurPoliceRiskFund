// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

enum UserRole {
  SuperAdmin
  UnitAdmin
}

enum MemberStatus {
  Opened
  Closed
}

enum MemberPostType {
  Officiating
  Temporary
  Substantive
}

enum ClosureReason {
  Retirement
  Death
  Doubling
  Expelled
}

model Member {
  id                      String         @id @default(uuid())
  membershipCode          String         @unique
  name                    String
  fatherName              String
  rank                    String
  trade                   String
  serviceNumber           String
  badgeNumber             String
  bloodGroup              String
  memberPostType          MemberPostType
  joiningRank             String
  dateOfBirth             DateTime
  dateOfEnrollment        DateTime
  superannuationDate      DateTime
  dateOfDischarge         DateTime?
  address                 String
  phone                   String
  status                  MemberStatus   @default(Opened)
  closureReason           ClosureReason?
  closureNotes            String?        @db.Text
  subscriptionStartDate   DateTime
  parentDepartment        String?
  dateApplied             DateTime
  receiptDate             DateTime
  allotmentDate           DateTime
  createdAt               DateTime       @default(now())
  updatedAt               DateTime       @updatedAt
  unitId                  String
  unit                    Unit           @relation(fields: [unitId], references: [id])
  nominees                Json
  firstWitness            Json
  secondWitness           Json
  payments                Payment[]
  transfers               Transfer[]

  @@index([unitId])
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      UserRole
  unitId    String?
  unit      Unit?    @relation(fields: [unitId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([unitId])
}

model Unit {
  id            String     @id @default(uuid())
  name          String     @unique
  members       Member[]
  transfersFrom Transfer[] @relation("FromUnit")
  transfersTo   Transfer[] @relation("ToUnit")
  users         User[]
}

model Payment {
  id          String   @id @default(uuid())
  amount      Decimal  @db.Decimal(10, 2)
  paymentDate DateTime
  months      Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  memberId    String
  member      Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([memberId])
}

model Transfer {
  id           String   @id @default(uuid())
  transferDate DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  memberId     String
  fromUnitId   String
  toUnitId     String
  member       Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  fromUnit     Unit     @relation("FromUnit", fields: [fromUnitId], references: [id])
  toUnit       Unit     @relation("ToUnit", fields: [toUnitId], references: [id])

  @@index([memberId])
  @@index([fromUnitId])
  @@index([toUnitId])
}

model Setting {
  id    String @id @default(uuid())
  key   String @unique
  value String @db.Text
}
