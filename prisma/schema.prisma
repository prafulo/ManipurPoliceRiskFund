generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  SuperAdmin
  UnitAdmin
}

enum MemberStatus {
  Opened
  Closed
}

enum ClosureReason {
  Retirement
  Death
  Doubling
  Expelled
}

enum MemberPostType {
  Officiating
  Temporary
  Substantive
}

model User {
  id       String   @id @default(uuid())
  email    String   @unique
  name     String
  password String
  role     UserRole @default(UnitAdmin)
  unitId   String?
  unit     Unit?    @relation(fields: [unitId], references: [id])
}

model Unit {
  id      String   @id @default(uuid())
  name    String   @unique
  members Member[]
  users   User[]
}

model Member {
  id                    String         @id @default(uuid())
  membershipCode        String         @unique
  name                  String
  fatherName            String
  rank                  String
  trade                 String
  serviceNumber         String
  badgeNumber           String
  bloodGroup            String
  memberPostType        MemberPostType
  joiningRank           String
  dateOfBirth           DateTime
  dateOfEnrollment      DateTime
  superannuationDate    DateTime
  dateOfDischarge       DateTime?
  address               String
  phone                 String
  unitId                String
  unit                  Unit           @relation(fields: [unitId], references: [id])
  status                MemberStatus   @default(Opened)
  closureReason         ClosureReason?
  closureNotes          String?        @db.Text
  subscriptionStartDate DateTime
  nominees              Json
  firstWitness          Json
  secondWitness         Json
  parentDepartment      String?
  dateApplied           DateTime
  receiptDate           DateTime
  allotmentDate         DateTime
  releaseDate           DateTime?
  releaseAmount         Decimal?       @db.Decimal(10, 2)
  releaseNotes          String?        @db.Text
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
  payments              Payment[]
  transfers             Transfer[]
}

model Payment {
  id          String   @id @default(uuid())
  memberId    String
  member      Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  amount      Decimal  @db.Decimal(10, 2)
  paymentDate DateTime @default(now())
  months      Json
}

model Transfer {
  id           String   @id @default(uuid())
  memberId     String
  member       Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  fromUnitId   String
  fromUnit     Unit     @relation("FromUnit", fields: [fromUnitId], references: [id])
  toUnitId     String
  toUnit       Unit     @relation("ToUnit", fields: [toUnitId], references: [id])
  transferDate DateTime @default(now())
  createdAt    DateTime @default(now())
}

model Setting {
  key   String @id
  value String
}

model Rank {
  id   String @id @default(uuid())
  name String @unique
}
