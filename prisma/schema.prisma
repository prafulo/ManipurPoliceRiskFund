// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Member {
  id                   String         @id @default(uuid())
  membershipCode       String         @unique
  name                 String
  fatherName           String
  rank                 String
  trade                String
  serviceNumber        String
  badgeNumber          String
  bloodGroup           String
  memberPostType       MemberPostType
  joiningRank          String
  dateOfBirth          DateTime
  dateOfEnrollment     DateTime
  superannuationDate   DateTime
  dateOfDischarge      DateTime?
  address              String
  phone                String
  status               MemberStatus   @default(Opened)
  closureReason        ClosureReason?
  closureNotes         String?        @db.Text
  subscriptionStartDate DateTime
  parentDepartment     String?
  dateApplied          DateTime
  receiptDate          DateTime
  allotmentDate        DateTime
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  unitId               String
  unit                 Unit           @relation(fields: [unitId], references: [id])
  nominees             Json
  firstWitness         Json
  secondWitness        Json
  payments             Payment[]
  transfers            Transfer[]

  @@map("members")
}

model Unit {
  id        String    @id @default(uuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  members   Member[]
  users     User[]
  transfersFrom Transfer[] @relation("FromUnit")
  transfersTo   Transfer[] @relation("ToUnit")

  @@map("units")
}

model Payment {
  id          String   @id @default(uuid())
  memberId    String
  member      Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  amount      Decimal  @db.Decimal(10, 2)
  paymentDate DateTime
  months      Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("payments")
}

model Transfer {
  id           String   @id @default(uuid())
  memberId     String
  member       Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  fromUnitId   String
  fromUnit     Unit     @relation("FromUnit", fields: [fromUnitId], references: [id])
  toUnitId     String
  toUnit       Unit     @relation("ToUnit", fields: [toUnitId], references: [id])
  transferDate DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("transfers")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String
  role      UserRole @default(UnitAdmin)
  unitId    String?
  unit      Unit?    @relation(fields: [unitId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Setting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("settings")
}


enum MemberStatus {
  Opened
  Closed
}

enum ClosureReason {
  Retirement
  Death
  Doubling
  Expelled
}

enum UserRole {
  SuperAdmin
  UnitAdmin
}

enum MemberPostType {
  Officiating
  Temporary
  Substantive
}
