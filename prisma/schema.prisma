generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String
  role      UserRole
  unitId    String?
  unit      Unit?    @relation(fields: [unitId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Unit {
  id            String     @id @default(uuid())
  name          String     @unique
  members       Member[]
  users         User[]
  transfersFrom Transfer[] @relation("FromUnit")
  transfersTo   Transfer[] @relation("ToUnit")

  @@map("units")
}

model Member {
  id                    String         @id @default(uuid())
  membershipCode        String         @unique
  name                  String
  fatherName            String
  rank                  String
  trade                 String
  serviceNumber         String
  badgeNumber           String
  bloodGroup            String
  memberPostType        MemberPostType
  joiningRank           String
  dateOfBirth           DateTime
  dateOfEnrollment      DateTime
  superannuationDate    DateTime
  dateOfDischarge       DateTime?
  address               String
  phone                 String
  unitId                String
  status                MemberStatus
  closureReason         ClosureReason?
  closureNotes          String?
  subscriptionStartDate DateTime
  nominees              Json
  firstWitness          Json
  secondWitness         Json
  parentDepartment      String?
  dateApplied           DateTime
  receiptDate           DateTime
  allotmentDate         DateTime
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
  releaseDate           DateTime?
  releaseAmount         Decimal? @db.Decimal(10, 2)
  releaseNotes          String?

  unit      Unit      @relation(fields: [unitId], references: [id], onDelete: Restrict)
  payments  Payment[]
  transfers Transfer[]
  @@map("members")
}

model Payment {
  id          String   @id @default(uuid())
  memberId    String
  amount      Decimal  @db.Decimal(10, 2)
  months      Json
  paymentDate DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  member      Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  @@map("payments")
}

model Transfer {
  id           String   @id @default(uuid())
  memberId     String
  fromUnitId   String
  toUnitId     String
  transferDate DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  member   Member @relation(fields: [memberId], references: [id], onDelete: Cascade)
  fromUnit Unit   @relation("FromUnit", fields: [fromUnitId], references: [id], onDelete: Restrict)
  toUnit   Unit   @relation("ToUnit", fields: [toUnitId], references: [id], onDelete: Restrict)
  @@map("transfers")
}

model Setting {
  key   String @id
  value String
  @@map("settings")
}

enum UserRole {
  SuperAdmin
  UnitAdmin
}

enum MemberStatus {
  Opened
  Closed
}

enum MemberPostType {
  Officiating
  Temporary
  Substantive
}

enum ClosureReason {
  Retirement
  Death
  Doubling
  Expelled
}
