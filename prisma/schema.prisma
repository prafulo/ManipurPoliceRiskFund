// datasource db {
//   provider = "mysql"
//   url      = env("DATABASE_URL")
// }

// generator client {
//   provider = "prisma-client-js"
// }

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Member {
  id                    String        @id @default(uuid())
  membershipCode        String        @unique
  name                  String
  fatherName            String
  rank                  String
  trade                 String
  serviceNumber         String
  badgeNumber           String
  bloodGroup            String
  memberPostType        MemberPostType
  joiningRank           String
  dateOfBirth           DateTime
  dateOfEnrollment      DateTime
  superannuationDate    DateTime
  dateOfDischarge       DateTime?
  address               String
  phone                 String
  status                MemberStatus  @default(Opened)
  closureReason         ClosureReason?
  closureNotes          String?       @db.Text
  subscriptionStartDate DateTime
  nominees              Json?
  firstWitness          Json?
  secondWitness         Json?
  parentDepartment      String?
  dateApplied           DateTime
  receiptDate           DateTime
  allotmentDate         DateTime
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  unitId                String
  unit                  units         @relation(fields: [unitId], references: [id])
  payments              Payment[]
  transfersFrom         Transfer[]    @relation("TransferFrom")
  transfersTo           Transfer[]    @relation("TransferTo")
}

model units {
  id            String     @id @default(uuid())
  name          String     @unique
  members       Member[]
  transfersFrom Transfer[] @relation("UnitTransfersFrom")
  transfersTo   Transfer[] @relation("UnitTransfersTo")
  users         users[]
}

model users {
  id       String   @id @default(uuid())
  email    String   @unique
  name     String
  password String
  role     UserRole
  unitId   String?
  unit     units?   @relation(fields: [unitId], references: [id])
}

model Payment {
  id          String   @id @default(uuid())
  amount      Float
  paymentDate DateTime
  months      Json
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  memberId    String
  member      Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
}

model Transfer {
  id           String   @id @default(uuid())
  transferDate DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  memberId     String
  member       Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  fromUnitId   String
  fromUnit     units    @relation("UnitTransfersFrom", fields: [fromUnitId], references: [id])
  toUnitId     String
  toUnit       units    @relation("UnitTransfersTo", fields: [toUnitId], references: [id])
}

model Setting {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum MemberStatus {
  Opened
  Closed
}

enum ClosureReason {
  Retirement
  Death
  Doubling
  Expelled
}

enum UserRole {
  SuperAdmin
  UnitAdmin
}

enum MemberPostType {
  Officiating
  Temporary
  Substantive
}
