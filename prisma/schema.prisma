// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  name      String
  password  String
  role      UserRole @default(UnitAdmin)
  unitId    String?
  unit      Unit?    @relation(fields: [unitId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model Unit {
  id        String    @id @default(uuid())
  name      String    @unique
  members   Member[]
  transfers Transfer[]
  users     User[]
}

model Member {
  id                   String          @id @default(uuid())
  membershipCode       String          @unique
  name                 String
  fatherName           String
  rank                 String
  trade                String
  serviceNumber        String
  badgeNumber          String
  bloodGroup           String
  memberPostType       MemberPostType
  joiningRank          String
  dateOfBirth          DateTime
  dateOfEnrollment     DateTime
  superannuationDate   DateTime
  dateOfDischarge      DateTime?
  address              String
  phone                String
  status               MemberStatus
  closureReason        ClosureReason?
  closureNotes         String?         @db.Text
  subscriptionStartDate DateTime
  parentDepartment     String?
  dateApplied          DateTime
  receiptDate          DateTime
  allotmentDate        DateTime
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt

  unitId               String
  unit                 Unit            @relation(fields: [unitId], references: [id], onDelete: Cascade)
  
  nominees             Json
  firstWitness         Json
  secondWitness        Json
  
  payments             Payment[]
  transfers            Transfer[]

  @@index([unitId])
}

model Payment {
  id           String   @id @default(uuid())
  amount       Decimal  @db.Decimal(10, 2)
  paymentDate  DateTime
  months       Json
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  memberId     String
  member       Member   @relation(fields: [memberId], references: [id], onDelete: Cascade)
  
  @@index([memberId])
}


model Transfer {
  id           String   @id @default(uuid())
  transferDate DateTime
  createdAt    DateTime @default(now())
  
  memberId     String
  fromUnitId   String
  toUnitId     String
  
  member       Member @relation(fields: [memberId], references: [id], onDelete: Cascade)
  fromUnit     Unit   @relation(fields: [fromUnitId], references: [id], onDelete: NoAction)
  toUnit       Unit   @relation(fields: [toUnitId], references: [id], onDelete: NoAction)

  @@index([memberId])
  @@index([fromUnitId])
  @@index([toUnitId])
}

model Setting {
  id    String @id @default(uuid())
  key   String @unique
  value String
}


enum MemberStatus {
  Opened
  Closed
}

enum ClosureReason {
  Retirement
  Death
  Doubling
  Expelled
}

enum MemberPostType {
  Officiating
  Temporary
  Substantive
}

enum UserRole {
  SuperAdmin
  UnitAdmin
}
